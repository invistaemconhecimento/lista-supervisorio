<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Controle de Equipamentos</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family:'Segoe UI', Tahoma, Geneva, Verdana,sans-serif; background:linear-gradient(135deg,#f5f7fa,#c3cfe2); min-height:100vh; padding:20px; }
.container { max-width:1200px; margin:0 auto; background:white; border-radius:15px; box-shadow:0 10px 30px rgba(0,0,0,0.1); overflow:hidden; }

/* Tela principal */
.tela-principal { display:block; }
.tela-detalhes { display:none; }

header { background:linear-gradient(135deg,#2c3e50,#4a6491); color:white; padding:30px; text-align:center; display:flex; flex-direction:column; align-items:center; gap:15px; }
header h1 { font-size:2.5rem; display:flex; align-items:center; justify-content:center; gap:15px; margin-bottom:0; flex-wrap:wrap; }
header h1 img { max-height:50px; border-radius:5px; }

.filtros-container {
    display: flex;
    flex-direction: column;
    gap: 15px;
    width: 100%;
    max-width: 100%;
}

.filtros { 
    display:grid; 
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); 
    gap:15px; 
    max-width:100%; 
    width:100%;
    margin:0 auto; 
    transition: all 0.3s ease;
}

.botoes-filtro {
    display: flex;
    justify-content: center;
    gap: 15px;
    margin-top: 10px;
    flex-wrap: wrap;
}

#btnLimparFiltros {
    background: #e74c3c;
    color: white;
    border: none;
    padding: 12px 25px;
    border-radius: 8px;
    font-size: 1rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 10px;
    transition: all 0.3s ease;
    font-weight: 600;
}

#btnLimparFiltros:hover {
    background: #c0392b;
    transform: translateY(-2px);
}

#searchInput, #filterCategory, #filterLocal, #filterTela, #filterOrigem, #filterSaida {
    padding:12px 20px; 
    border:none; 
    border-radius:8px; 
    font-size:1rem; 
    background:rgba(255,255,255,0.9); 
    width:100%;
}

.stats { font-size:1.1rem; opacity:0.9; margin-top:5px; text-align:center; transition: all 0.3s ease; }

main { padding:30px; text-align:center; }

.equipamentos-container { display:grid; grid-template-columns:repeat(auto-fill,minmax(300px,1fr)); gap:25px; transition: all 0.3s ease; }

.equipamento-card { 
    background:white; border-radius:10px; padding:25px; 
    box-shadow:0 5px 15px rgba(0,0,0,0.08); border-left:5px solid #3498db; 
    transition:transform 0.3s ease, box-shadow 0.3s ease, all 0.3s ease; 
    display:flex; flex-direction:column; align-items:center; text-align:center;
    cursor: pointer;
}
.equipamento-card:hover { transform:translateY(-5px); box-shadow:0 8px 20px rgba(0,0,0,0.12); }
.equipamento-card.reserva { border-left-color: #e67e22; background: #fff8f0; }

.equipamento-header { display:flex; justify-content:center; align-items:center; margin-bottom:15px; width:100%; }
.tag { background:#3498db; color:white; padding:8px 15px; border-radius:20px; font-weight:bold; font-size:0.9rem; }

.equipamento-info { margin-top:15px; flex:1; display:flex; flex-direction:column; gap:12px; align-items:center; }
.info-item { display:flex; align-items:center; justify-content:center; gap:8px; width:100%; }
.info-label { font-weight:600; color:#2c3e50; display:flex; align-items:center; gap:8px; }
.info-value { color:#34495e; flex:1; text-align:center; }

/* Tela de detalhes */
.detalhes-header {
    background:linear-gradient(135deg,#2c3e50,#4a6491);
    color:white;
    padding:30px;
    text-align:center;
    position: relative;
}

#btnVoltar {
    position: absolute;
    left: 30px;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(255,255,255,0.2);
    color: white;
    border: 2px solid white;
    padding: 12px 25px;
    border-radius: 8px;
    font-size: 1rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 10px;
    transition: all 0.3s ease;
    font-weight: 600;
}

#btnVoltar:hover {
    background: rgba(255,255,255,0.3);
    transform: translateY(-50%) scale(1.05);
}

.detalhes-header h2 {
    font-size: 2rem;
    margin: 0;
}

.detalhes-container {
    padding: 40px;
    max-width: 800px;
    margin: 0 auto;
}

.equipamento-detalhes {
    background: white;
    border-radius: 15px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    padding: 40px;
    text-align: left;
}

.detalhe-item {
    display: flex;
    margin-bottom: 25px;
    padding-bottom: 20px;
    border-bottom: 1px solid #eee;
    align-items: flex-start;
}

.detalhe-item:last-child {
    border-bottom: none;
    margin-bottom: 0;
    padding-bottom: 0;
}

.detalhe-icon {
    background: #3498db;
    color: white;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
    margin-right: 20px;
    flex-shrink: 0;
}

.detalhe-content {
    flex: 1;
}

.detalhe-label {
    font-weight: 600;
    color: #2c3e50;
    font-size: 1rem;
    margin-bottom: 5px;
    display: block;
}

.detalhe-value {
    color: #34495e;
    font-size: 1.2rem;
    line-height: 1.5;
}

.detalhe-item.reserva .detalhe-icon {
    background: #e67e22;
}

#btnFlutuanteTopo {
    position:fixed;
    bottom:25px;
    right:25px;
    width:55px;
    height:55px;
    border-radius:50%;
    border:none;
    background:#2c3e50;
    color:white;
    font-size:22px;
    cursor:pointer;
    display:flex;
    align-items:center;
    justify-content:center;
    box-shadow:0 4px 12px rgba(0,0,0,0.3);
    transition:0.3s ease, opacity 0.3s ease;
    opacity:0;
    pointer-events:none;
}
#btnFlutuanteTopo.show { opacity:1; pointer-events:auto; }
#btnFlutuanteTopo:hover { background:#1f2e3b; transform:scale(1.1); }

/* Índice responsivo - UMA LINHA POR EQUIPAMENTO */
.indice-container { 
    background:#ecf0f1; 
    padding:20px; 
    margin:0; 
    border-bottom:2px solid #bdc3c7; 
    transition: all 0.3s ease; 
    width: 100%;
    overflow-x: hidden;
}

.indice-container h2 { 
    margin-bottom:20px; 
    color:#2c3e50; 
    text-align:center; 
    font-size: 1.5rem;
}

#indiceEquipamentos { 
    list-style:none; 
    display:flex; 
    flex-direction: column;
    gap: 12px;
    justify-content:flex-start;
    transition: all 0.3s ease; 
    width: 100%;
    max-width: 100%;
    margin: 0 auto;
    padding: 0 10px;
}

#indiceEquipamentos li { 
    margin:0;
    width: 100%;
    display: flex;
    justify-content: center;
}

#indiceEquipamentos li a { 
    background:#3498db; 
    color:white; 
    padding:12px 20px; 
    border-radius:8px; 
    text-decoration:none; 
    font-size:1rem; 
    transition:all 0.3s ease; 
    display:flex; 
    align-items:center; 
    justify-content:center; 
    text-align:center; 
    cursor: pointer;
    width: 100%;
    max-width: 500px;
    min-height: 50px;
    border: none;
    outline: none;
    font-weight: 500;
    letter-spacing: 0.5px;
}

#indiceEquipamentos li a:hover { 
    background:#2978b8; 
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}
#indiceEquipamentos li a.active { 
    background:#e74c3c; 
    box-shadow: 0 4px 12px rgba(231, 76, 60, 0.3);
}
#indiceEquipamentos a.reserva { 
    background: #e67e22; 
}
#indiceEquipamentos a.reserva:hover { 
    background: #d35400; 
}

/* Indicador de scroll para índice */
.indice-scroll-indicator {
    text-align: center;
    color: #7f8c8d;
    font-size: 0.9rem;
    margin-top: 10px;
    display: none;
}

html { scroll-behavior:smooth; }

footer { background:#2c3e50; color:white; text-align:center; padding:20px; margin-top:30px; }

.no-results { grid-column:1/-1; text-align:center; padding:40px; color:#7f8c8d; font-size:1.2rem; }
.error { grid-column:1/-1; text-align:center; padding:40px; color:#e74c3c; font-size:1.2rem; }

@media(max-width:768px){
    header h1 { font-size:1.8rem; gap:10px; flex-direction:column; }
    header h1 img { max-height:40px; border-radius:5px; }
    .filtros { grid-template-columns: 1fr; gap:10px; }
    .botoes-filtro { flex-direction: column; align-items: center; }
    #btnLimparFiltros { width: 100%; max-width: 300px; justify-content: center; }
    
    /* Índice responsivo para mobile */
    #indiceEquipamentos { 
        padding: 0 5px;
        gap: 8px;
    }
    
    #indiceEquipamentos li a { 
        padding:10px 15px; 
        font-size:0.9rem; 
        max-width: 100%;
        min-height: 45px;
    }
    
    .indice-container h2 {
        font-size: 1.3rem;
        margin-bottom: 15px;
    }
    
    .equipamentos-container { grid-template-columns:1fr; }
    main { padding:20px; }
    .info-item { flex-direction:column; align-items:center; text-align:center; gap:5px; }
    
    .detalhes-header { padding: 20px; }
    #btnVoltar {
        position: relative;
        left: 0;
        top: 0;
        transform: none;
        margin-bottom: 15px;
        width: 100%;
        justify-content: center;
    }
    .detalhes-header h2 {
        font-size: 1.5rem;
    }
    .detalhes-container {
        padding: 20px;
    }
    .equipamento-detalhes {
        padding: 20px;
    }
    .detalhe-item {
        flex-direction: column;
        align-items: center;
        text-align: center;
    }
    .detalhe-icon {
        margin-right: 0;
        margin-bottom: 15px;
    }
}

@media(max-width:480px){
    #indiceEquipamentos li a { 
        padding:8px 12px; 
        font-size:0.85rem; 
        min-height: 40px;
        border-radius: 6px;
    }
    
    .indice-container h2 {
        font-size: 1.2rem;
    }
}

/* Para telas muito grandes */
@media(min-width:1200px){
    #indiceEquipamentos li a { 
        max-width: 600px;
    }
}
</style>
</head>
<body>
<div class="container">
    <!-- Tela Principal -->
    <div class="tela-principal">
        <header>
            <h1><img src="logoERO.png" alt="Logo ERO"> Guia de Equipamentos</h1>
            <div class="filtros-container">
                <div class="filtros">
                    <input type="text" id="searchInput" placeholder="Buscar por TAG, local, categoria, origem ou destino...">
                    <select id="filterCategory"><option value="">Todas as Categorias</option></select>
                    <select id="filterLocal"><option value="">Todos os Locais</option></select>
                    <select id="filterTela"><option value="">Todas as Telas</option></select>
                    <select id="filterOrigem"><option value="">Todas as Origens</option></select>
                    <select id="filterSaida"><option value="">Todas os Destinos</option></select>
                </div>
                <div class="botoes-filtro">
                    <button id="btnLimparFiltros">
                        <i class="fas fa-times-circle"></i> Limpar Filtros
                    </button>
                </div>
            </div>
            <div class="stats"><span id="totalEquipamentos">0 equipamentos</span></div>
        </header>

        <nav class="indice-container" id="topo-indice">
            <h2>Índice de Equipamentos</h2>
            <ul id="indiceEquipamentos"></ul>
            <div class="indice-scroll-indicator" id="indiceScrollIndicator">
                <i class="fas fa-arrow-down"></i> Role para ver mais equipamentos
            </div>
        </nav>

        <main>
            <div class="equipamentos-container" id="equipamentosContainer"></div>
        </main>

        <footer>
            <p>Desenvolvido por Alexandre Oliveira - +55 94 992327693</p>
            <p>Sistema de Controle de Equipamentos &copy; <span id="currentYear"></span></p>
        </footer>
    </div>

    <!-- Tela de Detalhes -->
    <div class="tela-detalhes">
        <header class="detalhes-header">
            <button id="btnVoltar">
                <i class="fas fa-arrow-left"></i> Voltar
            </button>
            <h2 id="detalhesTitulo">Detalhes do Equipamento</h2>
        </header>

        <main>
            <div class="detalhes-container">
                <div class="equipamento-detalhes" id="equipamentoDetalhes">
                    <!-- Detalhes serão carregados aqui -->
                </div>
            </div>
        </main>

        <footer>
            <p>Desenvolvido por Alexandre Oliveira - +55 94 992327693</p>
            <p>Sistema de Controle de Equipamentos &copy; <span id="currentYear2"></span></p>
        </footer>
    </div>
</div>

<button id="btnFlutuanteTopo" title="Voltar ao índice"><i class="fas fa-arrow-up"></i></button>

<script>
document.addEventListener('DOMContentLoaded', async () => {
    const currentYear = new Date().getFullYear();
    document.getElementById('currentYear').textContent = currentYear;
    document.getElementById('currentYear2').textContent = currentYear;

    let equipamentos = [];
    let equipamentoAtual = null;

    try {
        const response = await fetch('lista.json');
        equipamentos = await response.json();

        inicializarSistema(equipamentos);

    } catch (err) {
        console.error("Erro ao carregar JSON:", err);
        document.getElementById('equipamentosContainer').innerHTML = '<div class="error">Erro ao carregar os dados dos equipamentos.</div>';
    }
});

function inicializarSistema(equipamentos) {
    atualizarIndice(equipamentos);
    preencherFiltros(equipamentos);
    exibirEquipamentos(equipamentos);

    // Adicionar evento para o botão de limpar filtros
    document.getElementById('btnLimparFiltros').addEventListener('click', () => {
        limparFiltros(equipamentos);
    });

    // Adicionar evento para o botão de voltar
    document.getElementById('btnVoltar').addEventListener('click', () => {
        mostrarTelaPrincipal();
    });

    // Adicionar eventos para filtros
    document.getElementById('searchInput').addEventListener('input', () => filtrar(equipamentos));
    document.getElementById('filterCategory').addEventListener('change', () => filtrar(equipamentos));
    document.getElementById('filterLocal').addEventListener('change', () => filtrar(equipamentos));
    document.getElementById('filterTela').addEventListener('change', () => filtrar(equipamentos));
    document.getElementById('filterOrigem').addEventListener('change', () => filtrar(equipamentos));
    document.getElementById('filterSaida').addEventListener('change', () => filtrar(equipamentos));

    const botaoTopo = document.getElementById("btnFlutuanteTopo");
    botaoTopo.addEventListener("click", () => {
        if (document.querySelector('.tela-principal').style.display !== 'none') {
            document.getElementById('topo-indice').scrollIntoView({behavior:'smooth'});
        } else {
            window.scrollTo({top: 0, behavior: 'smooth'});
        }
    });

    window.addEventListener('scroll', () => {
        if(window.scrollY > 200){ 
            botaoTopo.classList.add('show'); 
        } else { 
            botaoTopo.classList.remove('show'); 
        }

        if (document.querySelector('.tela-principal').style.display !== 'none') {
            atualizarIndiceAtivo();
            verificarScrollIndice();
        }
    });
    
    // Mostrar indicador de scroll se houver muitos itens
    function verificarScrollIndice() {
        const indiceContainer = document.getElementById('indiceEquipamentos');
        const indicador = document.getElementById('indiceScrollIndicator');
        
        if (indiceContainer.scrollHeight > indiceContainer.clientHeight) {
            indicador.style.display = 'block';
        } else {
            indicador.style.display = 'none';
        }
    }
    
    // Verificar inicialmente
    setTimeout(verificarScrollIndice, 100);
}

function mostrarTelaPrincipal() {
    document.querySelector('.tela-principal').style.display = 'block';
    document.querySelector('.tela-detalhes').style.display = 'none';
    document.getElementById('btnFlutuanteTopo').classList.remove('show');
}

function mostrarTelaDetalhes(equipamento) {
    document.querySelector('.tela-principal').style.display = 'none';
    document.querySelector('.tela-detalhes').style.display = 'block';
    
    // Atualizar título
    document.getElementById('detalhesTitulo').textContent = `Detalhes - ${equipamento.tag}`;
    
    // Carregar detalhes do equipamento
    carregarDetalhesEquipamento(equipamento);
    
    // Scroll para o topo
    window.scrollTo({top: 0, behavior: 'instant'});
}

function carregarDetalhesEquipamento(equipamento) {
    const container = document.getElementById('equipamentoDetalhes');
    const descricao = equipamento['descrição'] || equipamento.descricao || '-';
    const saida = equipamento['destino'] || equipamento.saida || '-';
    const origem = equipamento.origem || '-';
    
    const icons = {
        tag: 'fas fa-hashtag',
        local: 'fas fa-map-marker-alt',
        categoria: 'fas fa-cog',
        tela: 'fas fa-tv',
        origem: 'fas fa-arrow-right',
        destino: 'fas fa-arrow-left',
        descricao: 'fas fa-info-circle',
        id: 'fas fa-id-card'
    };
    
    const isReserva = String(equipamento.tag).endsWith('R');
    
    let html = `
        <div class="detalhe-item ${isReserva ? 'reserva' : ''}">
            <div class="detalhe-icon">
                <i class="${icons.id}"></i>
            </div>
            <div class="detalhe-content">
                <span class="detalhe-label">ID</span>
                <span class="detalhe-value">${equipamento.id || '-'}</span>
            </div>
        </div>
        
        <div class="detalhe-item ${isReserva ? 'reserva' : ''}">
            <div class="detalhe-icon">
                <i class="${icons.tag}"></i>
            </div>
            <div class="detalhe-content">
                <span class="detalhe-label">TAG</span>
                <span class="detalhe-value">${equipamento.tag || '-'} ${isReserva ? '<span style="color:#e67e22; font-weight:bold;">(Reserva)</span>' : ''}</span>
            </div>
        </div>
        
        <div class="detalhe-item">
            <div class="detalhe-icon">
                <i class="${icons.local}"></i>
            </div>
            <div class="detalhe-content">
                <span class="detalhe-label">Local</span>
                <span class="detalhe-value">${equipamento.local || '-'}</span>
            </div>
        </div>
        
        <div class="detalhe-item">
            <div class="detalhe-icon">
                <i class="${icons.categoria}"></i>
            </div>
            <div class="detalhe-content">
                <span class="detalhe-label">Categoria</span>
                <span class="detalhe-value">${equipamento.categoria || '-'}</span>
            </div>
        </div>
        
        <div class="detalhe-item">
            <div class="detalhe-icon">
                <i class="${icons.descricao}"></i>
            </div>
            <div class="detalhe-content">
                <span class="detalhe-label">Descrição</span>
                <span class="detalhe-value">${descricao}</span>
            </div>
        </div>
        
        <div class="detalhe-item">
            <div class="detalhe-icon">
                <i class="${icons.tela}"></i>
            </div>
            <div class="detalhe-content">
                <span class="detalhe-label">Tela</span>
                <span class="detalhe-value">${equipamento.tela || '-'}</span>
            </div>
        </div>
        
        <div class="detalhe-item">
            <div class="detalhe-icon">
                <i class="${icons.origem}"></i>
            </div>
            <div class="detalhe-content">
                <span class="detalhe-label">Origem</span>
                <span class="detalhe-value">${origem}</span>
            </div>
        </div>
        
        <div class="detalhe-item">
            <div class="detalhe-icon">
                <i class="${icons.destino}"></i>
            </div>
            <div class="detalhe-content">
                <span class="detalhe-label">Destino</span>
                <span class="detalhe-value">${saida}</span>
            </div>
        </div>
    `;
    
    container.innerHTML = html;
}

function limparFiltros(equipamentos) {
    // Limpar todos os campos de filtro
    document.getElementById('searchInput').value = '';
    document.getElementById('filterCategory').value = '';
    document.getElementById('filterLocal').value = '';
    document.getElementById('filterTela').value = '';
    document.getElementById('filterOrigem').value = '';
    document.getElementById('filterSaida').value = '';
    
    // Restaurar a exibição de todos os equipamentos
    atualizarIndice(equipamentos);
    exibirEquipamentos(equipamentos);
}

function preencherFiltros(equipamentos){
    const selectCategoria = document.getElementById('filterCategory');
    const selectLocal = document.getElementById('filterLocal');
    const selectTela = document.getElementById('filterTela');
    const selectOrigem = document.getElementById('filterOrigem');
    const selectSaida = document.getElementById('filterSaida');

    // Limpar opções existentes (exceto a primeira)
    [selectCategoria, selectLocal, selectTela, selectOrigem, selectSaida].forEach(select => {
        while(select.options.length > 1) {
            select.remove(1);
        }
    });

    // categorias
    [...new Set(equipamentos.map(e => (e.categoria || '').trim()))].filter(Boolean).sort().forEach(c => {
        const option = document.createElement('option'); option.value=c; option.textContent=c; selectCategoria.appendChild(option);
    });

    // locais
    [...new Set(equipamentos.map(e => (e.local || '').trim()))].filter(Boolean).sort().forEach(l => {
        const option = document.createElement('option'); option.value=l; option.textContent=l; selectLocal.appendChild(option);
    });

    // telas
    [...new Set(equipamentos.map(e => (e.tela || '').trim()))].filter(Boolean).sort().forEach(t => {
        const option = document.createElement('option'); option.value=t; option.textContent=t; selectTela.appendChild(option);
    });

    // origens
    [...new Set(equipamentos.map(e => ((e.origem || '') + '').trim()))].filter(Boolean).sort().forEach(en => {
        const option = document.createElement('option'); option.value=en; option.textContent=en; selectOrigem.appendChild(option);
    });

    // destinos
    [...new Set(equipamentos.map(e => ((e['destino'] || '') + '').trim()))].filter(Boolean).sort().forEach(sa => {
        const option = document.createElement('option'); option.value=sa; option.textContent=sa; selectSaida.appendChild(option);
    });
}

function atualizarIndice(equipamentos){
    const indice = document.getElementById('indiceEquipamentos');
    indice.innerHTML = '';
    equipamentos.forEach(e => {
        const li = document.createElement('li');
        const link = document.createElement('a');
        link.href = '#';
        link.className = String(e.tag).endsWith('R') ? 'reserva' : '';
        link.textContent = e.tag;
        link.addEventListener('click', (event) => {
            event.preventDefault();
            mostrarTelaDetalhes(e);
        });
        li.appendChild(link);
        indice.appendChild(li);
    });
}

function atualizarContagem(equipamentos){
    const span = document.getElementById('totalEquipamentos');
    span.textContent = `${equipamentos.length} equipamento${equipamentos.length !== 1 ? 's' : ''}`;
}

function exibirEquipamentos(equipamentos){
    const container = document.getElementById('equipamentosContainer'); 
    container.innerHTML='';
    if(equipamentos.length === 0){ 
        container.innerHTML='<div class="no-results">Nenhum equipamento encontrado.</div>'; 
    } else {
        equipamentos.forEach(e => {
            const card = criarCard(e);
            card.addEventListener('click', () => {
                mostrarTelaDetalhes(e);
            });
            container.appendChild(card);
        });
    }
    atualizarContagem(equipamentos);
}

function criarCard(e){
    const card = document.createElement('div');
    card.className = 'equipamento-card';
    if(String(e.tag).endsWith('R')) card.classList.add('reserva');
    card.id = `equip-${String(e.tag).replace(/[^a-zA-Z0-9]/g,'')}`;
    const icons = {local:'fas fa-map-marker-alt', categoria:'fas fa-cog', tela:'fas fa-tv', origem:'fas fa-arrow-right', destino:'fas fa-arrow-left', descricao:'fas fa-info-circle'};
    const descricao = e['descrição'] || e.descricao || '-';
    const saida = e['destino'] || e.saida || '';
    card.innerHTML = `
        <div class="equipamento-header"><span class="tag">${e.tag}</span></div>
        <div class="equipamento-info">
            <div class="info-item"><span class="info-label"><i class="${icons.local}"></i> Local:</span><span class="info-value">${e.local || '-'}</span></div>
            <div class="info-item"><span class="info-label"><i class="${icons.categoria}"></i> Categoria:</span><span class="info-value">${e.categoria || '-'}</span></div>
            <div class="info-item"><span class="info-label"><i class="${icons.descricao}"></i> Descrição:</span><span class="info-value">${descricao}</span></div>
            <div class="info-item"><span class="info-label"><i class="${icons.tela}"></i> Tela:</span><span class="info-value">${e.tela || '-'}</span></div>
            <div class="info-item"><span class="info-label"><i class="${icons.origem}"></i> Origem:</span><span class="info-value">${e.origem || '-'}</span></div>
            <div class="info-item"><span class="info-label"><i class="${icons.destino}"></i> Destino:</span><span class="info-value">${saida || '-'}</span></div>
        </div>
        <div style="margin-top:15px; color:#3498db; font-size:0.9rem;">
            <i class="fas fa-external-link-alt"></i> Clique para ver detalhes
        </div>
    `;
    return card;
}

function filtrar(equipamentos){
    const termo = document.getElementById('searchInput').value.toLowerCase().trim();
    const cat = document.getElementById('filterCategory').value;
    const local = document.getElementById('filterLocal').value;
    const tela = document.getElementById('filterTela').value;
    const origemFiltro = document.getElementById('filterOrigem').value;
    const saidaFiltro = document.getElementById('filterSaida').value;

    const filtrados = equipamentos.filter(e => {
        const tag = String(e.tag || '').toLowerCase();
        const loc = String(e.local || '').toLowerCase();
        const catE = String(e.categoria || '').toLowerCase();
        const tel = String(e.tela || '').toLowerCase();
        const ent = String(e.origem || '').toLowerCase();
        const sai = String(e['destino'] || e.saida || '').toLowerCase();

        const termoMatch = !termo || tag.includes(termo) || loc.includes(termo) || catE.includes(termo) || tel.includes(termo) || ent.includes(termo) || sai.includes(termo);

        return termoMatch
            && (!cat || e.categoria === cat)
            && (!local || e.local === local)
            && (!tela || e.tela === tela)
            && (!origemFiltro || (e.origem === origemFiltro))
            && (!saidaFiltro || ((e['destino'] || e.saida) === saidaFiltro));
    });

    exibirEquipamentos(filtrados);
    atualizarIndice(filtrados);
}

function atualizarIndiceAtivo(){
    const cards = document.querySelectorAll('.equipamento-card');
    let indexAtivo = null;
    cards.forEach((card,i) => {
        const rect = card.getBoundingClientRect();
        if(rect.top <= 150 && rect.bottom >= 150){ indexAtivo=i; }
    });
    const links = document.querySelectorAll('#indiceEquipamentos a');
    links.forEach(l => l.classList.remove('active'));
    if(indexAtivo !== null){
        const tagID = cards[indexAtivo].id;
        // Encontrar o link correspondente pelo texto da TAG
        const linkAtivo = Array.from(links).find(link => {
            const tagText = link.textContent;
            return tagID.includes(tagText.replace(/[^a-zA-Z0-9]/g, ''));
        });
        if(linkAtivo) linkAtivo.classList.add('active');
    }
}
</script>
</body>
</html>
